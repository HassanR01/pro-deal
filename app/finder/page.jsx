import React from 'react'
import TitlePage from '../components/main/title'
import FinderPage from '../components/finder/FinderPage'
import { GoogleAnalytics } from '@next/third-parties/google'

const fetchData = async (endpoint) => {
  const apiUrl = process.env.NEXT_PUBLIC_API_URL; // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† API_URL Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ø¨ÙŠØ¦Ø©
  if (!apiUrl) {
    console.error("âŒ API_URL is missing! Set NEXT_PUBLIC_API_URL in .env");
    return null;
  }

  try {
    const res = await fetch(`${apiUrl}/api/${endpoint}`);

    if (!res.ok) {
      throw new Error(`âŒ Failed to fetch ${endpoint}: ${res.status} ${res.statusText}`);
    }

    return await res.json();

  } catch (error) {
    console.error(`ğŸš¨ Error fetching ${endpoint}:`, error.message);
    return null; // ØªØ¬Ù†Ø¨ ÙƒØ³Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
  }
};

// Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
const getZones = () => fetchData("zones");
const getDevelopers = () => fetchData("developers");
const getProperties = () => fetchData("properties");
const getProjects = () => fetchData("projects");


export const metadata = {
  title: "Free Finder - Aqary Store | Ø§Ø¨Ø­Ø« Ø¨Ø­Ø±ÙŠØ© Ø¹Ù† Ø¹Ù‚Ø§Ø±Ùƒ ÙÙŠ Ù…ØªØ¬Ø± Ø¹Ù‚Ø§Ø±ÙŠ",
  description: "Ø¹Ù‚Ø§Ø±Ùƒ Ù‡ØªÙ„Ø§Ù‚ÙŠÙ‡ ÙÙŠ Ø¹Ù‚Ø§Ø±ÙŠØŒ Ù…ØªØ¬Ø± Ø¹Ù‚Ø§Ø±ÙŠ Ù‡Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ Ø§Ù„Ø±Ø§Ø¦Ø¯ ÙÙŠ ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ùˆ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ùˆ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ© ÙÙŠ Ø³ÙˆØ§Ø­Ù„ Ù…ØµØ± Ùˆ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©ØŒ Ø§Ø³ØªØ«Ù…Ø§Ø±Ùƒ Ø§Ù„Ø¢Ù…Ù† Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø¹Ù‚Ø§Ø±ÙŠ - Generated By Rockai Dev",
};


export default async function Finder({ searchParams }) {
  const { zones } = await getZones()
  const { developers } = await getDevelopers()
  const { properties } = await getProperties()
  const { projects } = await getProjects()


  return (
    <>
      <TitlePage />
      <section>
        <FinderPage developers={developers} zones={zones} projects={projects} properties={properties} params={searchParams} />
      </section>
      <GoogleAnalytics gaId="G-3EVKQWKC3S" />
    </>
  )
}
