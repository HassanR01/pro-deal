import React from 'react'
import TitlePage from '../components/main/title'
import FinderPage from '../components/finder/FinderPage'
import { GoogleAnalytics } from '@next/third-parties/google'

const fetchData = async (endpoint) => {
  const apiUrl = process.env.API_URL; // ุชุฃูุฏ ูู ุฃู API_URL ูุชุงุญุฉ ูู ุงูุจูุฆุฉ
  if (!apiUrl) {
    console.error("โ API_URL is missing! Set API_URL in .env");
    return null;
  }

  try {
    const res = await fetch(`${apiUrl}/api/${endpoint}`);

    if (!res.ok) {
      throw new Error(`โ Failed to fetch ${endpoint}: ${res.status} ${res.statusText}`);
    }

    return await res.json();

  } catch (error) {
    console.error(`๐จ Error fetching ${endpoint}:`, error.message);
    return []; // ุชุฌูุจ ูุณุฑ ุงูุชุทุจูู ุนูุฏ ุงูุฎุทุฃ
  }
};

// ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูุนุงูุฉ ูุฌููุน ุงูุทูุจุงุช
const getZones = () => fetchData("zones");
const getDevelopers = () => fetchData("developers");
const getProperties = () => fetchData("properties");
const getProjects = () => fetchData("projects");


export const metadata = {
  title: "Free Finder - Pro Deal | ุงุจุญุซ ุจุญุฑูุฉ ุนู ุนูุงุฑู ูู ุจุฑู ุฏูู",
  description: "ุงุณุชุซูุฑ ูู ุงูุงูุงูุฉ ู ุนูุด ูู ุงูุฑูุงููุฉุ ุจุฑู ุฏูู ูู ุงููููุน ุงูุนูุงุฑู ุงูุฑุงุฆุฏ ูู ุชุฌุงุฑุฉ ุงูุนูุงุฑุงุช ู ุงูุงุณุชุดุงุฑุงุช ุงูุนูุงุฑูุฉ ู ุงูุงุณุชุซูุงุฑูุฉ ูู ุณูุงุญู ูุตุฑ ู ุงููุฏู ุงูุญุฏูุซุฉุ ุงุณุชุซูุงุฑู ุงูุขูู ูุน ูุฑูู ุจุฑู ุฏูู - Generated By Rockai Dev",
};


export default async function Finder({ searchParams }) {
  const { zones } = await getZones()
  const { developers } = await getDevelopers()
  const { properties } = await getProperties()
  const { projects } = await getProjects()


  return (
    <>
      <TitlePage />
      <section>
        <FinderPage developers={developers} zones={zones} projects={projects} properties={properties} params={searchParams} />
      </section>
      <GoogleAnalytics gaId="G-3EVKQWKC3S" />
    </>
  )
}
