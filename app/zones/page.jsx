import React from 'react'
import TitlePage from '../components/main/title'
import Link from 'next/link'
import Image from 'next/image'
import { GoogleAnalytics } from '@next/third-parties/google'

const getZones = async () => {
  const apiUrl = process.env.API_URL; // Ø§Ø³ØªØ®Ø¯Ù… NEXT_PUBLIC Ù„ÙŠÙƒÙˆÙ† Ù…ØªØ§Ø­Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­

  if (!apiUrl) {
    console.error("âŒ API_URL is missing! Set API_URL in .env");
    return null;
  }

  try {
    const res = await fetch(`${apiUrl}/api/zones`);

    if (!res.ok) {
      throw new Error(`âŒ Failed to fetch zones: ${res.status} ${res.statusText}`);
    }

    const data = await res.json();
    return data;

  } catch (error) {
    console.error("ğŸš¨ Error fetching zones:", error.message);
    return []; // Ù„ØªØ¬Ù†Ø¨ ÙƒØ³Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  }
};

export const metadata = {
  title: "Zones - Pro Deal | Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ - Ø¨Ø±Ùˆ Ø¯ÙŠÙ„",
  description: "Ø¹Ù‚Ø§Ø±Ùƒ Ù‡ØªÙ„Ø§Ù‚ÙŠÙ‡ ÙÙŠ Ø¹Ù‚Ø§Ø±ÙŠØŒ Ù…ØªØ¬Ø± Ø¹Ù‚Ø§Ø±ÙŠ Ù‡Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ Ø§Ù„Ø±Ø§Ø¦Ø¯ ÙÙŠ ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ùˆ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ùˆ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ© ÙÙŠ Ø³ÙˆØ§Ø­Ù„ Ù…ØµØ± Ùˆ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©ØŒ Ø§Ø³ØªØ«Ù…Ø§Ø±Ùƒ Ø§Ù„Ø¢Ù…Ù† Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø¹Ù‚Ø§Ø±ÙŠ - Generated By Rockai Dev",
};

export default async function page() {
  const { zones } = await getZones()
  return (
    <>
      <TitlePage />
      <section>
        <div className="title my-4 flex items-center justify-center flex-col">
          <h3 className='text-3xl lg:text-5xl items-center font-black'>Ù…Ù†Ø§Ø·Ù‚ Ø§Ø³ØªØ«Ù…Ø§Ø±Ùƒ ÙÙŠ Ù…ØµØ±</h3>
        </div>

        <div className="Zones flex flex-wrap items-center justify-center w-full">
          {zones.map(zone => (
            <Link key={zone._id} className='flex flex-col items-center m-3' href={`/zones/${zone.name}`}>
              <Image className='rounded-xl h-20' src={zone.image ? zone.image : '/city.png'} width={120} height={120} alt='city Icon' />
              <h2 className='text-textColor text-xl my-2 font-mainFont font-bold'>{zone.name}</h2>
              <div className="flex flex-row items-center justify-center my-2 font-mainFont font-bold">
                <div className="flex flex-col items-center justify-center mx-4">
                  <h3 className='text-sm'>{zone.projects.length}</h3>
                  <h4 className='text-sm'>Ù…Ø´Ø±ÙˆØ¹</h4>
                </div>
                <div className="flex flex-col items-center justify-center mx-4">
                  <h3 className='text-sm'>{zone.properties.length}</h3>
                  <h4 className='text-sm'>ÙˆØ­Ø¯Ø©</h4>
                </div>
              </div>
            </Link>
          ))}
        </div>

      </section>
            <GoogleAnalytics gaId="G-3EVKQWKC3S" />
    </>
  )
}
