import React from 'react'
import Link from 'next/link'
import Image from 'next/image'
import { GoogleAnalytics } from '@next/third-parties/google'
import TitlePage from '../components/main/title';

const getDevelopers = async () => {
  const apiUrl = process.env.API_URL; // Ø§Ø³ØªØ®Ø¯Ù… NEXT_PUBLIC_ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© ÙÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ„

  if (!apiUrl) {
    console.error("âŒ API_URL is missing! Set NEXT_PUBLIC_API_URL in .env");
    return null;
  }

  try {
    const res = await fetch(`${apiUrl}/api/developers`);

    if (!res.ok) {
      throw new Error(`âŒ Failed to fetch developers: ${res.status} ${res.statusText}`);
    }

    return await res.json();

  } catch (error) {
    console.error(`ğŸš¨ Error fetching developers:`, error.message);
    return null;
  }
};


export const metadata = {
  title: "Developers - Aqary Store | Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙŠÙ† - Ù…ØªØ¬Ø± Ø¹Ù‚Ø§Ø±ÙŠ",
  description: "Ø¹Ù‚Ø§Ø±Ùƒ Ù‡ØªÙ„Ø§Ù‚ÙŠÙ‡ ÙÙŠ Ø¹Ù‚Ø§Ø±ÙŠØŒ Ù…ØªØ¬Ø± Ø¹Ù‚Ø§Ø±ÙŠ Ù‡Ùˆ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ Ø§Ù„Ø±Ø§Ø¦Ø¯ ÙÙŠ ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ùˆ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ùˆ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ© ÙÙŠ Ø³ÙˆØ§Ø­Ù„ Ù…ØµØ± Ùˆ Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ø­Ø¯ÙŠØ«Ø©ØŒ Ø§Ø³ØªØ«Ù…Ø§Ø±Ùƒ Ø§Ù„Ø¢Ù…Ù† Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø¹Ù‚Ø§Ø±ÙŠ - Generated By Rockai Dev",
};

export default async function page() {
  const { developers } = await getDevelopers()
  return (
    <>
      <TitlePage />
      <section>
        <div className="title my-4 flex items-center justify-center flex-col">
          <h3 className='text-3xl lg:text-5xl items-center font-black'>Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ† Ø§Ù„Ø±Ø§Ø¦Ø¯ÙŠÙ† Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±Ùƒ ÙÙŠ Ù…ØµØ±</h3>
        </div>

        <div className="developers flex flex-wrap items-center justify-center w-full">
          {developers?.map(developer => (
            <Link key={developer._id} className='min-w-80 flex flex-col items-center justify-between m-3 p-2' href={`/developers/${developer.name}`}>
              <div className="image h-40 rounded-full overflow-hidden shadow-xl border-2">
                <Image src={developer.image} className='w-full h-full' width={100} height={100} alt='city Icon' />
              </div>
              <h2 className='text-textColor text-xl my-2 font-mainFont font-bold'>{developer.name}</h2>
              <div className="flex flex-row items-center justify-center my-2 font-mainFont font-bold">
                <div className="flex flex-col items-center justify-center mx-4">
                  <h3 className='text-sm'>{developer.projects.length}</h3>
                  <h4 className='text-sm'>Ù…Ø´Ø±ÙˆØ¹</h4>
                </div>
                <div className="flex flex-col items-center justify-center mx-4">
                  <h3 className='text-sm'>{developer.properties.length}</h3>
                  <h4 className='text-sm'>ÙˆØ­Ø¯Ø©</h4>
                </div>
              </div>
            </Link>
          ))}
        </div>

      </section>
      <GoogleAnalytics gaId="G-3EVKQWKC3S" />
    </>
  )
}
